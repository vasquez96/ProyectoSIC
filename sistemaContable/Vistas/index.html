{% extends 'base.html' %}
{%load static %}
{% block head %}
<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Administraci√≥n contable</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/fontawesomefontawesome-free/css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bbootstrap 4 -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/css/adminlte.min.css' %}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'lib/AdminLTE3.0.4/plugins/summernote/summernote-bs4.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="{% static 'lib/Canvas/js/Chart.js' %}"></script>
  <script src="{% static 'lib/Canvas/js/Chart.min.js' %}"></script>
{% endblock %}

{% block content %}
<!--% for dep, valor in departamentos.items %}
{dep}} { valor }}<br/> -->
<!--% endfor %} -->


<section class="content">
<br/> 
<div class="container"> <!--container-->
<div class="container-fluid"> <!-- container -fluid -->
<div class="panel panel-default"> <!--panel-->
<div class="panel-body"> <!--panel body-->
<div class="row"> <!-- row-->
 
</div> <!-- row-->
</div> <!--panel body-->
</div> <!-- panel -->
</div> <!-- container fluid-->
</div> <!--container-->

</section> <!--CONTENT-->

<div class="row">
  <div class="col-md-8">
   <!-- TABLE: LATEST ORDERS -->
   <div class="card">
    <div class="card-header border-transparent">
      {% if sin_ciclo == True %}
      <h3 class="card-title">Ultimas partidas de diario ingresadas - Ciclo ID <b>No establecido</b></h3>
      {% else %}
      <h3 class="card-title">Ultimas partidas de diario ingresadas - Ciclo ID <b>{{ciclo_id}}</b></h3>
      {% endif %}

      <div class="card-tools">
        <button type="button" class="btn btn-tool" data-card-widget="collapse">
          <i class="fas fa-minus"></i>
        </button>
        <button type="button" class="btn btn-tool" data-card-widget="remove">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <!-- /.card-header -->
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table m-0">
          <thead>
          <tr>
            <th>Fecha</th>
            <th>Id Partida</th>
            <th>Descripcion</th>
            <th>Saldo</th>
            <th>Operaciones</th>
          </tr>
          </thead>
          <tbody>
          {% if sin_ciclo == True %}
          <tr><td colspan="5"><center><b>Sin Partidas Ingresadas</b></center></td></tr>
          {% else %}

            {% if partidas|length == 0 %}
                <tr><td colspan="5"><center><b>Sin Partidas Ingresadas</b></center></td></tr>
            {% else %}
                {% for p in partidas %}
                    <tr>
                          <td>
                            {{p.fecha_partida}}
                          </td>
                          <td>
                            {{p.id_partida}}
                          </td>
                          <td>
                            {{p.descripcion_partida}}
                          </td>
                          <td>
                            {{p.saldo_partida}}
                          </td>

                          <td>
                            <div class="input-group-append">
                              <button id="{{ p.id_partida }}visualizarbtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#visualizarPartidaModal">Visualizar</button>
                            </div>
                          </td>

                    </tr>
                {% endfor %}
            {% endif %}

          {% endif %}
       
          </tbody>
        </table>
      </div>
      <!-- /.table-responsive -->
    </div>

    <!-- /.card-body 
    <div class="card-footer clearfix">
      <a href="javascript:void(0)" class="btn btn-sm btn-info float-left">Place New Order</a>
      <a href="javascript:void(0)" class="btn btn-sm btn-secondary float-right">View All Orders</a>
    </div>
    -->

    <!-- /.card-footer -->
  </div> <!-- col-md- 8-->

  </div>
  <div class="col-md-4">
    <div class="sticky-top mb-3">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Opciones</h4>
        </div>
        <div class="card-body">
          <!-- the events -->
          <div id="external-events">
            {% if sin_ciclo == False %}
              <center><div class="btn btn-success btn-lg" onclick="" id="nuevoCicloContablebtn" disabled>Iniciar ciclo contable</div></center>
            {% else %}
            <center><div class="btn btn-success btn-lg" onclick="" id="nuevoCicloContablebtn" >Iniciar ciclo contable</div></center>
            {% endif %}

            {% if sin_ciclo == True %}
            <center><div class="btn btn-primary btn-lg" onclick="{% url 'ingresarPartidaDiario' %}" disabled>Ingresar Nueva Partida</div></center>
            {% else %}
            <center><div class="btn btn-primary btn-lg" onclick="{% url 'ingresarPartidaDiario' %}" >Ingresar Nueva Partida</div></center>
            {% endif %}

            {% if sin_ciclo == False %}
            <center><div class="btn btn-danger btn-lg" id="finalizarCicloContablebtn" onclick="" disabled>Finalizar ciclo contable</div></center>
            {% else %}
            <center><div class="btn btn-danger btn-lg" id="finalizarCicloContablebtn" onclick="" >Finalizar ciclo contable</div></center>
            {% endif %}

            <ul class="list-group">
              {% if sin_ciclo == True %}
              <li class="list-group-item">Inicio de Ciclo <b> Ciclo No Establecido</b></li>
              {% else %}
              <li class="list-group-item">Inicio de Ciclo <b>{{fecha_inicio_ciclo|date}}</b></li>
              {% endif %}
              <li class="list-group-item">Fecha Actual <b>{{fecha_hoy}}</b></li>
            </ul>
          </div>
        </div>
        <!-- /.card-body -->
      </div>
      <!-- /.card -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Filtrar</h3>
        </div>
        <div class="card-body">
          <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
            <!--<button type="button" id="color-chooser-btn" class="btn btn-info btn-block dropdown-toggle" data-toggle="dropdown">Color <span class="caret"></span></button>-->
            
          </div>
          <!-- /btn-group -->
          <div class="input-group">
            <input id="new-event" type="text" class="form-control" placeholder="Event Title">

            <div class="input-group-append">
              <button id="add-new-event" type="button" class="btn btn-primary">Obtener</button>
            </div>
            <!-- /btn-group -->
          </div>
          <!-- /input-group -->
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL  VISUALIZAR -->
  <div class="modal fade modal-dialog-center"  tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" id="visualizarPartidaModal">
    <div class="modal-dialog">
     <div class="modal-content-wrap">
         <div class="modal-content">
             <div class="modal-header" style="background-color: rgb(22, 135, 180)">
                 <h4 class="modal-tittle">Partida de Diario</h4>
             </div>
             <div class="modal-body">
                 <div class="contenedor">
                     CONTENIDO
                     <div class="card">
                      <div class="card-header">
                        <h3 class="card-title">Filtrar</h3>
                      </div>
                      <div class="card-body">
                        <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
                          <!--<button type="button" id="color-chooser-btn" class="btn btn-info btn-block dropdown-toggle" data-toggle="dropdown">Color <span class="caret"></span></button>-->
                          <ul class="fc-color-picker" id="color-chooser">
                            <li><a class="text-primary" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-warning" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-success" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-danger" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-muted" href="#"><i class="fas fa-square"></i></a></li>
                          </ul>
                        </div>
                        <!-- /btn-group -->
                        <div class="input-group">
                          <input id="new-event" type="text" class="form-control" placeholder="Event Title">
              
                          <div class="input-group-append">
                            <button id="add-new-event" type="button" class="btn btn-primary">Obtener</button>
                          </div>
                          <!-- /btn-group -->
                        </div>
                        <!-- /input-group -->
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header">
                        <h3 class="card-title">Filtrar</h3>
                      </div>
                      <div class="card-body">
                        
                        <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
                          <!--<button type="button" id="color-chooser-btn" class="btn btn-info btn-block dropdown-toggle" data-toggle="dropdown">Color <span class="caret"></span></button>-->
                          
                          <ul class="fc-color-picker" id="color-chooser">
                            
                            <li><a class="text-primary" href="#"><i class="fas fa-square"></i>dfsdfd</a></li>
                            <li><a class="text-warning" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-success" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-danger" href="#"><i class="fas fa-square"></i></a></li>
                            <li><a class="text-muted" href="#"><i class="fas fa-square"></i></a></li>
                          </ul>
                        </div>
                        <!-- /btn-group -->
                        <div class="input-group">
                          <input id="new-event" type="text" class="form-control" placeholder="Event Title">
              
                          <div class="input-group-append">
                            <button id="add-new-event" type="button" class="btn btn-primary">Obtener</button>
                          </div>
                          <!-- /btn-group -->
                        </div>
                        <!-- /input-group -->
                      </div>
                    </div>

                 </div>
             </div>
             <div class="modal-footer">
                 <button data-dismiss="modal" class="btn btn-default">Cerrar</button>
                 <button data-dismiss="modal" class="btn btn-success">Ingresar</button>
             </div>
         </div>
     </div>
     </div>
 </div>
</div>
<!-- MODAL VISUALIZAR -->


<!-- Modal de respuesta del guardado -->
<div class="modal fade" id="modal_resultado">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style= "font-family:'Times New Roman', Times, serif">Resultado</h4>
        <button type="button" id="btn_cerrar" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" >
          <p id="resul"> </p> 
      
    
        <!-- /.card-body -->
      </div>
      <!-- /.card -->
    </div>
      </div>
        
      
    </div>

<!-- modal de respuesta del guardado-->


</div>
</div>



<script src="{% static 'lib/AdminLTE3.0.4/plugins/chart.js/Chart.min.js' %}"></script>
<!-- jQuery -->
<script src="{% static 'lib/AdminLTE3.0.4/plugins/jquery/jquery.min.js' %}"></script>

<!--SCRIPT QUE INICIA NUEVO CICLO CONTABLE Y CONTROL DEL BOTON DE CICLO CONTABLE-->
<script>
  $("#nuevoCicloContablebtn").on('click', function(e){

    e.preventDefault();

    var attr = $(this).attr('disabled');

// For some browsers, `attr` is undefined; for others,
// `attr` is false.  Check for both.
    if(typeof attr !== typeof undefined && attr !== false)
    {

    }
    else
    {

    

    $.ajax({
      url: '{% url "iniciarCicloContable" %}',
      data: {},
      dataType: 'json',
      success: function (data) 
      {
      console.log(data);

      if(data[0].creado == true)
      {
        $("#modal_resultado").modal("show");
        resul="Su Resultado es: INICIADO NUEVO CICLO CONTABLE "
        $("#resul").html(resul);
        location.reload();
      }

   
      
      }
      });
    }
  });
</script>

<script>
  $("#finalizarCicloContablebtn").on('click', function(e){

    var id_ciclo_contable = {{ciclo_id}};
    $.ajax({
      url: '{% url "finalizarCicloContable" %}',
      data: {id_ciclo: id_ciclo_contable},
      dataType: 'json',
      success: function (data) 
      {
      console.log(data);

      if(data[0].finalizado == true)
      {
        $("#modal_resultado").modal("show");
        resul="Su Resultado es: SE HA FINALIZADO EL CICLO CONTABLE "
        $("#resul").html(resul);
        location.reload();
      }
      }
      });

  });
</script>
{% endblock %}
